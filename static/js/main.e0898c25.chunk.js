(this["webpackJsonpthree-videos"]=this["webpackJsonpthree-videos"]||[]).push([[0],{312:function(e,t,n){},313:function(e,t,n){},315:function(e,t,n){},316:function(e,t,n){},317:function(e,t,n){},318:function(e,t,n){},319:function(e,t,n){},320:function(e,t,n){},325:function(e,t){},326:function(e,t){},334:function(e,t){},337:function(e,t,n){},338:function(e,t,n){},340:function(e,t,n){"use strict";n.r(t);var r=n(15),a=n(12),c=n.n(a),i=n(234),o=n.n(i),s=(n(312),n(313),n(11)),u=n.n(s),d=n(17),l=n(4),f=function(e){var t={playWhenReady:function(){return e.play()},canvasImageSource:e,width:function(){return e.videoWidth},height:function(){return e.videoHeight},isEnded:function(){return!1},pause:function(){return!1},onEnded:void 0,isPlaying:function(){return!!(e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2)},isReady:function(){return!0}};return e.addEventListener("play",(function(){t.isEnded=function(){return!1}})),e.addEventListener("ended",(function(){var e;t.isEnded=function(){return!0},null===(e=t.onEnded)||void 0===e||e.call(t)})),t},b=n(29),j=n(235),v=n.n(j),p=n(236),h={detectorCanvas:void 0,isPhotoMode:!0,audioStream:void 0,videoStream:void 0,recordings:{},fakedRecording:void 0,fakedRecordingPromise:void 0,staticFiles:void 0,isPlaybackReady:!1,isTracking:!1,currentPlaybackTrack:void 0,config:{recordingDuration:4,apiUrl:"https://three-videos-api.jaeperris.com",webcamScale:2}},g=v()((function(e,t){return Object(b.a)(Object(b.a)({},h),{},{setAudioStream:function(n){t().closeStreams(),n.getTracks().forEach((function(e){e.addEventListener("ended",(function(){t().closeStreams()}))})),e({audioStream:n})},setVideoStream:function(n){t().closeStreams(),n.getTracks().forEach((function(e){e.addEventListener("ended",(function(){t().closeStreams()}))})),e({videoStream:n})},closeStreams:function(){var n=t().audioStream,r=t().videoStream;n&&n.getTracks().forEach((function(e){e.stop()})),r&&r.getTracks().forEach((function(e){e.stop()})),e({audioStream:void 0,videoStream:void 0})},setVideoRecording:function(t){e({recordings:{video:t}})},setImageRecording:function(t){e({recordings:{image:t}})},setStaticFiles:function(t){var n=t.start,r=t.soundOne,a=t.soundTwo,c=t.end;e({staticFiles:{start:n,soundOne:r,soundTwo:a,end:c}})},setFakedRecording:function(t){e({fakedRecording:t})},setFakedRecordingPromise:function(t){e({fakedRecordingPromise:t})},setPlaybackReadiness:function(t){return e({isPlaybackReady:t})},resetState:function(){var n=Object(b.a)({},t().config);e(Object(b.a)(Object(b.a)({},h),{},{config:Object(b.a)({},n)}))},setPlaybackTrack:function(t){return e({currentPlaybackTrack:t})},setIsTracking:function(t){return e({isTracking:t})}})})),m=Object(p.a)(g),O=function(e){var t=e.start,n=e.tracking,c=e.middle,i=e.end,o=Object(a.useRef)(null),s=Object(a.useState)(),f=Object(l.a)(s,2),b=f[0],j=f[1],v={width:t.width(),height:t.height()},p=Object(a.useState)(0),h=Object(l.a)(p,2),O=h[0],w=h[1],k=m((function(e){return e.setPlaybackTrack}));return Object(a.useEffect)((function(){j([t,n,function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c;case 2:return t=e.sent,e.abrupt("return",x(t));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),i])}),[i,c,t,n]),y(30,Object(d.a)(u.a.mark((function e(){var t,n,r,a,c,i,s,d,l,f,j;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==b){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,b[O];case 4:if(n=e.sent,r=null===(t=o.current)||void 0===t?void 0:t.getContext("2d"),void 0!==n){e.next=8;break}return e.abrupt("return");case 8:if(!1!==n.isReady()){e.next=10;break}return e.abrupt("return");case 10:if(void 0!==r&&null!==r){e.next=12;break}return e.abrupt("return");case 12:if(1===O&&r.clearRect(0,0,v.width,v.height),2!==O){e.next=21;break}if(void 0!==(i=null===(a=g.getState().videoStream)||void 0===a||null===(c=a.getTracks()[0])||void 0===c?void 0:c.getSettings())){e.next=17;break}return e.abrupt("return");case 17:(s=i.width/i.height)<1.777?(d=(v.width-v.height*s)/2,0,r.clearRect(0,0,v.width,v.height),l=v.width-2*d,f=v.height-0,r.drawImage(n.canvasImageSource,d,0,l,f)):(0,j=(v.height-v.width/s)/2,r.clearRect(0,0,v.width,v.height),r.drawImage(n.canvasImageSource,0,j,v.width-0,v.height-2*j)),e.next=22;break;case 21:r.drawImage(n.canvasImageSource,0,0,v.width,v.height);case 22:case"end":return e.stop()}}),e)})))),Object(a.useEffect)((function(){if(void 0!==b){var e=function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b[O];case 2:if(void 0!==(t=e.sent)){e.next=5;break}throw new Error("currentVideoIndex out of range. Got ".concat(O,", expected between 0 and ").concat(b.length));case 5:return t.onEnded=function(){k((O+1)%b.length),w((O+1)%b.length)},t.isPlaying()||(console.log("playing video ".concat(O)),t.playWhenReady()),e.abrupt("return",(function(){t.pause()}));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()();return function(){e.then((function(e){return null===e||void 0===e?void 0:e()}))}}}),[O,k,b]),Object(r.jsx)("canvas",{style:{width:"100%"},ref:o,width:v.width,height:v.height})};function x(e){return w.apply(this,arguments)}function w(){return(w=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=document.createElement("video"),a=f(r);r.src=URL.createObjectURL(t),r.load(),r.onloadeddata=function(){return e(a)},r.onerror=function(e){return n(e)}})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=function(e,t){var n=Object(a.useRef)(),r=Object(a.useRef)(),c=Object(a.useCallback)((function(e){if(void 0!==r.current){var n=e-r.current;t(n)}r.current=e}),[t]);Object(a.useEffect)((function(){var t=setInterval((function(){n.current=requestAnimationFrame(c)}),1e3/e);return function(){n.current&&cancelAnimationFrame(n.current),t&&clearInterval(t)}}),[c,e])},k=function(e,t){var n=!1,r={playWhenReady:function(){n=!0,a()},canvasImageSource:e,width:function(){return e.width},height:function(){return e.height},isEnded:function(){return!1},pause:function(){return!1},onEnded:void 0,isPlaying:function(){return!!(t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2)},isReady:function(){return g.getState().isTracking}};t.addEventListener("ended",(function(){var e;r.isEnded=function(){return!0},null===(e=r.onEnded)||void 0===e||e.call(r)}));var a=function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||r.isPlaying()||!r.isReady()){e.next=6;break}return e.next=3,t.play();case 3:n=!1,e.next=7;break;case 6:setTimeout((function(){console.log("tryplay"),a()}),1e3);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return g.subscribe(function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.isReady=function(){return t};case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return e.isTracking})),r},S=(n(315),Object(a.forwardRef)((function(e,t){return Object(r.jsx)("button",Object(b.a)(Object(b.a)({ref:t,className:"Button"},e),{},{children:e.children}))}))),R=(n(316),function(e){var t=e.reason;return Object(r.jsx)("div",{className:"Message ErrorMessage",children:Object(r.jsxs)("span",{children:["Error: ",t]})})}),E=function(e){var t=e.text;return Object(r.jsx)("div",{className:"Message PromptMessage",children:Object(r.jsx)("span",{children:t})})},P=function(e){var t=e.text;return Object(r.jsx)("div",{className:"Message SuccessMessage",children:Object(r.jsxs)("span",{children:["Success: ",t]})})},A=function(e){var t=e.text;return Object(r.jsx)("div",{className:"Message NeutralMessage",children:Object(r.jsx)("span",{children:t})})},I=function(e){var t=e.apiUrl,n=e.autoSubmit,c=m((function(e){var t;return null===(t=e.staticFiles)||void 0===t?void 0:t.soundOne})),i=m((function(e){var t;return null===(t=e.recordings)||void 0===t?void 0:t.video})),o=m((function(e){var t;return null===(t=e.recordings)||void 0===t?void 0:t.image})),s=m((function(e){return e.fakedRecording})),f=m((function(e){return e.config.webcamScale})),b=m((function(e){return e.isPhotoMode})),j=m((function(e){return e.setFakedRecording})),v=m((function(e){return e.setFakedRecordingPromise})),p=Object(a.useCallback)((function(){if(void 0===c)return"awaitingAudioSource";if(b){if(void 0===o)return"awaitingDestinationImage"}else if(void 0===i)return"awaitingDestinationVideo";return void 0!==s?"success":"prompt"}),[c,o,i,b,s]),h=Object(a.useState)(p),g=Object(l.a)(h,2),O=g[0],x=g[1],w=Object(a.useCallback)(Object(d.a)(u.a.mark((function e(){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c){e.next=4;break}return console.error("Audio source not yet ready"),x("errorSources"),e.abrupt("return");case 4:if(b||i){e.next=8;break}return console.error("Webcam video source not yet ready"),x("errorSources"),e.abrupt("return");case 8:if(!b||o){e.next=12;break}return console.error("Webcam image source not yet ready"),x("errorSources"),e.abrupt("return");case 12:n=new FormData,b?n.append("image",o.blob):n.append("video",i.blob),n.append("webcamScale",f.toFixed(0)),r=new Promise(function(){var e=Object(d.a)(u.a.mark((function e(r,a){var c,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,x("awaitingResult"),e.next=4,fetch(t+"/three_videos_demo",{method:"POST",body:n,mode:"cors"});case 4:return c=e.sent,e.next=7,c.blob();case 7:if("video/mp4"===(i=e.sent).type){e.next=13;break}return x("errorApi"),console.error("Response from server was not a video"),a("Response from server was not a video"),e.abrupt("return");case 13:x("success"),j(i),r(i),e.next=23;break;case 18:e.prev=18,e.t0=e.catch(0),x("errorApi"),console.error(e.t0),a(e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,n){return e.apply(this,arguments)}}()),v(r);case 17:case"end":return e.stop()}}),e)}))),[t,c,o,i,b,j,v,f]);return Object(a.useEffect)((function(){var e=p();x(e)}),[p]),Object(a.useEffect)((function(){"prompt"===O&&n&&w()}),[n,w,O]),Object(r.jsxs)("div",{className:"Api",children:["awaitingAudioSource"===O&&Object(r.jsx)(A,{text:"Awaiting audio source"}),"awaitingDestinationVideo"===O&&Object(r.jsx)(A,{text:"Awaiting destination video"}),"awaitingDestinationImage"===O&&Object(r.jsx)(A,{text:"Awaiting destination image"}),"prompt"===O&&Object(r.jsx)(E,{text:"Source and Destination ready to be faked"}),!O.includes("awaiting")&&Object(r.jsx)(S,{onClick:w,children:"Send to API"}),"awaitingResult"===O&&Object(r.jsx)(A,{text:"Waiting for Api response"}),"success"===O&&Object(r.jsx)(P,{text:"Got faked recording from Api"}),"errorApi"===O&&Object(r.jsx)(R,{reason:"Could not fetch from Api"}),"errorSources"===O&&Object(r.jsx)(R,{reason:"Souces are not ready"})]})},T=n.p+"static/media/1.8387f5c7.mp4",F=n.p+"static/media/1-sound.9a7498fb.mp3",C=n.p+"static/media/2-sound.a491b656.mp3",U=n.p+"static/media/3.40b0841d.mp4",N=function(){var e=m((function(e){return!!e.staticFiles})),t=m((function(e){return e.setStaticFiles})),n=Object(a.useState)(e?"loaded":"notLoaded"),c=Object(l.a)(n,2),i=c[0],o=c[1];return Object(a.useEffect)((function(){e||function(){var e=Object(d.a)(u.a.mark((function e(){var n,r,a,c,i,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o("loading"),e.prev=1,n=M(T),r=D(F),a=D(C),c=M(U),[n,r,a,c].map((function(e){return e.then((function(e){return console.log(e)}))})),e.next=9,Promise.all([n,r,a,c]);case 9:i=e.sent,o("loaded"),t({start:i[0],soundOne:i[1],soundTwo:i[2],end:i[3]}),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(1),o("error"),console.warn("Could not load element ".concat(null===e.t0||void 0===e.t0||null===(s=e.t0.path[0])||void 0===s?void 0:s.src)),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(){return e.apply(this,arguments)}}()()}),[e,t]),Object(r.jsxs)("div",{className:"StaticFileLoader",children:["notLoaded"===i&&Object(r.jsx)(A,{text:"Files not loaded"}),"loading"===i&&Object(r.jsx)(A,{text:"Files loading"}),"loaded"===i&&Object(r.jsx)(P,{text:"Files loaded!"}),"error"===i&&Object(r.jsx)(R,{reason:"Files could not load"})]})},M=function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(d.a)(u.a.mark((function e(n,r){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(a=document.createElement("video")).src=t,a.onerror=function(e){return r(e)},a.onloadeddata=function(){n(a)},a.load();case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=document.createElement("audio");r.src=t,r.onerror=function(e){return n(e)},r.oncanplaythrough=function(){e(r),r.oncanplaythrough=null},r.load()})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=(n(317),function(){var e=m((function(e){return e.staticFiles})),t=m((function(e){return e.fakedRecordingPromise})),n=m((function(e){return e.setPlaybackReadiness}));return Object(a.useEffect)((function(){n(!(!e||!t))}),[t,e,n]),e?t?Object(r.jsx)(P,{text:"Videos Ready"}):Object(r.jsx)(R,{reason:"Fake recording not received"}):Object(r.jsx)(R,{reason:"Static videos not loaded"})}),V=new AbortController,B=V.signal;function W(e){if(200===e.status)return e;throw new Error(e.statusText)}var H=function(e){var t=e.apiUrl,n=Object(a.useCallback)(Object(d.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t+"/three_videos_is_up",{signal:B}).then(W);case 3:return n=e.sent,e.next=6,n.blob();case 6:if(!(e.sent.size<=0)){e.next=9;break}throw new Error("API Failed. Did not get blob successfully");case 9:s("success"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),s("errorApi"),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,12]])}))),[t]);Object(a.useEffect)((function(){n();var e=setInterval(Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V.abort(),V=new AbortController,B=V.signal,e.next=5,n();case 5:case"end":return e.stop()}}),e)}))),1e4);return function(){return clearInterval(e)}}),[n]);var c=Object(a.useState)("idle"),i=Object(l.a)(c,2),o=i[0],s=i[1];return Object(r.jsxs)("div",{className:"Api",children:["idle"===o&&Object(r.jsx)(A,{text:"Api test idle"}),"success"===o&&Object(r.jsx)(P,{text:"Api is Up"}),"errorApi"===o&&Object(r.jsx)(R,{reason:"Api is down"})]})},_=(n(318),function(e){return Object(r.jsx)("div",{className:"LabelledInput",children:Object(r.jsxs)("label",{className:"Label",children:[Object(r.jsxs)("span",{children:[e.label," "]}),Object(r.jsx)("input",Object(b.a)(Object(b.a)({className:"Input"},e),{},{children:e.children}))]})})}),z=(n(319),function(e){return Object(r.jsx)("div",{className:"LabelledSelect",children:Object(r.jsxs)("label",{className:"Label",children:[Object(r.jsxs)("span",{children:[e.label," "]}),Object(r.jsx)("select",Object(b.a)(Object(b.a)({className:"Select"},e),{},{children:e.options.map((function(e,t){var n=Object(l.a)(e,2),a=n[0],c=n[1];return Object(r.jsx)("option",{value:a,children:c},t)}))}))]})})}),G=function(){var e=m((function(e){return e.config.webcamScale})),t=m((function(e){return e.config.recordingDuration})),n=m((function(e){return e.config.apiUrl}));return Object(r.jsxs)("div",{className:"Config",children:[Object(r.jsx)(_,{label:"Recording Duration:",name:"recordingDuration",type:"number",min:0,max:16,value:t,onChange:function(e){var t=g.getState().config,n=parseInt(e.target.value,10);g.setState({config:Object(b.a)(Object(b.a)({},t),{},{recordingDuration:n})})}}),Object(r.jsx)(_,{label:"API Url:",name:"apiUrl",type:"string",value:n,onChange:function(e){var t=g.getState().config,n=e.target.value;g.setState({config:Object(b.a)(Object(b.a)({},t),{},{apiUrl:n})})}}),Object(r.jsx)(z,{label:"Webcam Scale",options:[[1,"100%"],[2,"50%"],[3,"33%"],[4,"25%"]],value:e,onChange:function(e){var t=g.getState().config,n=parseInt(e.target.value,10);g.setState({config:Object(b.a)(Object(b.a)({},t),{},{webcamScale:n})})}})]})},J=(n(320),function(e){var t=e.imageUrl,n=Object(a.useRef)(null);return Object(a.useEffect)((function(){n.current&&(n.current.src=t)}),[t]),Object(r.jsx)("div",{className:"ImageRecordedPreview",children:Object(r.jsx)("img",{alt:"ImageRecordedPreview",ref:n})})}),q=function(){var e=m((function(e){return e.config.apiUrl})),t=Object(a.useState)(!1),n=Object(l.a)(t,2),c=n[0],i=n[1],o=Object(a.useRef)(null),s={transform:"translate(0, 0)",opacity:"1"},u=Object(a.useState)({transform:"translate(0, 0)",opacity:"0"}),d=Object(l.a)(u,2),f=d[0],b=d[1],j=m((function(e){var t;return null===(t=e.recordings.image)||void 0===t?void 0:t.url}));Object(a.useEffect)((function(){var e,t=null===(e=o.current)||void 0===e?void 0:e.getBoundingClientRect().bottom;if(t){var n="translate(0, ".concat(window.innerHeight-t,"px)");b({transform:n,opacity:"0"})}}),[]);return Object(r.jsxs)("div",{style:f,className:"DevUi",children:[Object(r.jsx)(S,{ref:o,onClick:function(){var e;i(!c);var t=null===(e=o.current)||void 0===e?void 0:e.getBoundingClientRect().bottom;if(c&&t){var n="translate(0, ".concat(window.innerHeight-t,"px)");b({transform:n,opacity:"0"})}else b(s)},children:c?"Hide":"Show"}),j&&Object(r.jsx)(J,{imageUrl:j}),Object(r.jsx)(G,{}),Object(r.jsx)(N,{}),Object(r.jsx)(H,{apiUrl:e}),Object(r.jsx)(I,{autoSubmit:!c,apiUrl:e}),Object(r.jsx)(L,{}),Object(r.jsx)(S,{onClick:g.getState().resetState,children:"Reset State"})]})},K=n(19),Q=n(257),X=(n(339),n(0)),Y=n(258),Z=n(41),$=[new Z.Vector3(0,0,0),new Z.Vector3(100,0,0),new Z.Vector3(100,100,0),new Z.Vector3(0,100,0)],ee=[new Z.Face3(0,1,3),new Z.Face3(1,2,3)],te=function(e){var t=e.stream,n=Object(a.useRef)(),c=Object(a.useRef)(null),i=Object(a.useRef)(),o=Object(a.useRef)();Object(a.useEffect)((function(){(function(){var e=Object(d.a)(u.a.mark((function e(){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.current){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,X.tb("webgl");case 4:return(r=c.current).width=t.getTracks()[0].getSettings().width,r.height=t.getTracks()[0].getSettings().height,r.srcObject=t,r.play(),e.next=11,new Promise((function(e){r.onloadedmetadata=function(){e(r)}}));case 11:return e.next=13,Q.a({maxFaces:1});case 13:return n.current=e.sent,e.next=16,n.current.estimateFaces(r,!1,!0,!0);case 16:e.sent;case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[t,c]);var s=Object(a.useRef)(document.createElement("canvas"));Object(a.useEffect)((function(){var e=c.current,t=s.current;e&&t&&(t.width=1920,t.height=1080,g.setState({detectorCanvas:t}))}));return y(30,Object(d.a)(u.a.mark((function e(){var t,r,a,d,f,b,j,v,p,h,m,O,x,w,y,k,S,R,E,P,A,I,T,F,C,U;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1===g.getState().currentPlaybackTrack){e.next=3;break}return e.abrupt("return");case 3:if(g.getState().isTracking||g.getState().setIsTracking(!0),c.current&&n.current&&i.current&&s.current&&o.current){e.next=6;break}return e.abrupt("return");case 6:return f=o.current,b=c.current,j=n.current,e.next=11,j.estimateFaces(b,!1,!0,!0);case 11:if(0!==(v=e.sent).length){e.next=14;break}return e.abrupt("return");case 14:for(p=i.current.geometry,h=p.getAttribute("position"),m=b.getBoundingClientRect(),O=v.map((function(e){return e.landmarks})).flat(),x=function(e,t){return[-(e/b.width*m.width-m.width/2),-(t/b.height*m.height-m.height/2)]},w=0;w<50;w++)y=O[w]||[2e3,2e3],k=Object(l.a)(y,2),S=k[0],R=k[1],E=x(S,R),P=Object(l.a)(E,2),A=P[0],I=P[1],h.set([A,I,0],3*w);h.needsUpdate=!0,T=x.apply(void 0,Object(K.a)(v[0].topLeft)),F=x.apply(void 0,Object(K.a)(v[0].bottomRight)),C=[T[0],F[1]],U=[F[0],T[1]],null===(t=f.geometry.vertices[0])||void 0===t||t.set.apply(t,Object(K.a)(T).concat([0])),null===(r=f.geometry.vertices[1])||void 0===r||r.set.apply(r,U.concat([0])),null===(a=f.geometry.vertices[2])||void 0===a||a.set.apply(a,Object(K.a)(F).concat([0])),null===(d=f.geometry.vertices[3])||void 0===d||d.set.apply(d,C.concat([0])),f.geometry.verticesNeedUpdate=!0,f.geometry.computeFaceNormals();case 31:case"end":return e.stop()}}),e)})))),y(30,Object(d.a)(u.a.mark((function e(){var t,n,r,a,i,o,d,l,f,b;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1===g.getState().currentPlaybackTrack){e.next=3;break}return e.abrupt("return");case 3:if(t=document.getElementById("CanvasPoints"),c.current&&t&&s.current){e.next=6;break}return e.abrupt("return");case 6:if(n=t.firstChild){e.next=9;break}return e.abrupt("return");case 9:r=c.current,a=s.current,i=r.videoWidth/r.videoHeight,t.style.width=r.getBoundingClientRect().width+"px",t.style.height=r.getBoundingClientRect().width/i+"px",o=a.getContext("2d"),i<1.777?(d=(a.width-a.height*i)/2,0,o.clearRect(0,0,a.width,a.height),l=a.width-2*d,f=a.height-0,o.drawImage(r,d,0,l,f),o.drawImage(n,d,0,l,f)):(0,b=(a.height-a.width/i)/2,o.clearRect(0,0,a.width,a.height),o.drawImage(r,0,b,a.width-0,a.height-2*b),o.drawImage(n,0,b,a.width-0,a.height-2*b));case 16:case"end":return e.stop()}}),e)})))),Object(r.jsx)(r.Fragment,{children:Object(r.jsxs)("div",{style:{opacity:0,width:"100%",position:"absolute"},children:[Object(r.jsx)("video",{style:{width:"100%",height:"100%",objectFit:"contain",position:"absolute",transform:"translate(-50%, -50%)",left:"50%",top:"50%"},width:"100%",autoPlay:!0,height:"100%",ref:c}),Object(r.jsxs)(Y.a,{id:"CanvasPoints",style:{width:"100%"},orthographic:!0,pixelRatio:window.devicePixelRatio,webgl1:!0,camera:{near:-1e4,far:1e4},noEvents:!0,onPointerMove:void 0,onMouseMove:void 0,children:[Object(r.jsxs)("mesh",{ref:o,children:[Object(r.jsx)("geometry",{vertices:$,faces:ee}),Object(r.jsx)("meshBasicMaterial",{color:"red",side:Z.DoubleSide,opacity:.2,transparent:!0})]}),Object(r.jsxs)("points",{ref:i,children:[Object(r.jsx)("bufferGeometry",{drawRange:{start:0,count:50},children:Object(r.jsx)("bufferAttribute",{attachObject:["attributes","position"],itemSize:3,array:new Float32Array(150),count:50})}),Object(r.jsx)("pointsMaterial",{color:"green",size:10})]})]})]})})},ne=function(e){var t=e.stream,n=e.duration,c=Object(a.useState)(n),i=Object(l.a)(c,2),o=i[0],s=i[1],f=Object(a.useState)(!1),b=Object(l.a)(f,2),j=b[0],v=b[1],p=m((function(e){return e.setImageRecording})),h=Object(a.useMemo)((function(){return re(t)}),[t]),g=Object(a.useState)("prompt"),O=Object(l.a)(g,2),x=O[0],w=O[1];Object(a.useEffect)((function(){j||"recorded"!==x&&(w("prompt"),s(n),v(!1))}),[j,x,t,n]),Object(a.useEffect)((function(){if(j){var e=setTimeout(Object(d.a)(u.a.mark((function e(){var t,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o>0)){e.next=3;break}return s(o-1),e.abrupt("return");case 3:return e.next=5,h();case 5:t=e.sent,n=t.imageBlob,r=t.imageUrl,w("recorded"),v(!1),p({blob:n,url:r});case 11:case"end":return e.stop()}}),e)}))),1e3);return function(){return clearTimeout(e)}}}),[j,p,o,h]);return Object(r.jsxs)("div",{className:"ImageRecorder",children:["prompt"===x&&Object(r.jsx)(E,{text:"Our AI needs to be trained. Say cheese in ".concat(n," seconds")}),"counting-down"===x&&Object(r.jsx)(A,{text:"".concat(o,"s")}),"recorded"===x&&Object(r.jsx)(P,{text:"Trained!"}),"counting-down"!==x&&Object(r.jsx)(S,{onClick:function(){s(n),w("counting-down"),v(!0)},children:"Record Image"})]})},re=function(e){var t,n,r=document.createElement("video"),a=(null===(t=e.getTracks()[0])||void 0===t?void 0:t.getSettings().width)||1280,c=(null===(n=e.getTracks()[0])||void 0===n?void 0:n.getSettings().height)||720;r.setAttribute("width",a+"px"),r.setAttribute("height",c+"px"),r.srcObject=e,r.play();var i=document.createElement("canvas");i.width=a,i.height=c;var o=i.getContext("2d");i.setAttribute("width",a+"px"),i.setAttribute("height",c+"px");return function(){return new Promise(function(){var e=Object(d.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.fillStyle="#AAA",o.fillRect(0,0,i.width,i.height),o.drawImage(r,0,0,i.width,i.height),n=i.toDataURL("image/png"),e.next=6,ae(i);case 6:a=e.sent,t({imageBlob:a,imageUrl:n});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}};function ae(e){return new Promise((function(t,n){e.toBlob((function(e){null!==e?t(e):n("Blob was not created successfully from image")}))}))}n(337);var ce=function(e){var t=e.stream,n=Object(a.useRef)(null);return Object(a.useEffect)((function(){n.current&&(n.current.srcObject=t)}),[t]),Object(r.jsx)("div",{className:"VideoStreamPreview",children:Object(r.jsx)("video",{autoPlay:!0,ref:n})})},ie=(n(338),function(){var e=m((function(e){return!!e.videoStream})),t=m((function(e){return e.setVideoStream})),n=Object(a.useState)(e?"accepted":"prompt"),c=Object(l.a)(n,2),i=c[0],o=c[1];e&&"accepted"!==i&&o("accepted"),e||"accepted"!==i||o("errorDisconnected");var s=function(){var e=Object(d.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe();case 2:if(n=e.sent){e.next=6;break}return o("errorVideo"),e.abrupt("return");case 6:t(n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)("div",{className:"Permissions",children:[Object(r.jsx)(E,{text:"This is an interactive documentary. The interaction is provided via your webcam. Please enable this now."}),Object(r.jsx)(S,{onClick:s,children:"Enable Webcam"}),"accepted"===i&&Object(r.jsx)(E,{text:"Devices connected!"}),"errorVideo"===i&&Object(r.jsx)(R,{reason:"Could not get webcam."}),"errorDisconnected"===i&&Object(r.jsx)(R,{reason:"Devices disconnected."})]})});function oe(){return se.apply(this,arguments)}function se(){return(se=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:{width:1280,height:720,facingMode:"user"},audio:!1});case 3:return t=e.sent,e.abrupt("return",t);case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",void 0);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}var ue=function(e){var t=e.stream,n=e.duration,c=Object(a.useState)(n),i=Object(l.a)(c,2),o=i[0],s=i[1],f=Object(a.useState)(!1),b=Object(l.a)(f,2),j=b[0],v=b[1],p=m((function(e){return e.setVideoRecording})),h=Object(a.useMemo)((function(){return de(t)}),[t]),g=Object(a.useState)("prompt"),O=Object(l.a)(g,2),x=O[0],w=O[1];Object(a.useEffect)((function(){j||"recorded"!==x&&(w("prompt"),s(n),v(!1))}),[j,x,t,n]),Object(a.useEffect)((function(){if(j){var e=setTimeout(Object(d.a)(u.a.mark((function e(){var t,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o>0)){e.next=3;break}return s(o-1),e.abrupt("return");case 3:return e.next=5,h.stop();case 5:t=e.sent,n=t.videoBlob,r=t.videoUrl,w("recorded"),v(!1),p({blob:n,url:r});case 11:case"end":return e.stop()}}),e)}))),1e3);return function(){return clearTimeout(e)}}}),[j,p,o,h]);return Object(r.jsxs)("div",{className:"VideoRecorder",children:["prompt"===x&&Object(r.jsx)(E,{text:"Our AI needs to be trained. Please record ".concat(n," seconds of your webcam")}),"recording"===x&&Object(r.jsx)(A,{text:"Recoding for another: ".concat(o,"s")}),"recorded"===x&&Object(r.jsx)(P,{text:"Trained!"}),"recording"!==x&&Object(r.jsx)(S,{onClick:function(){s(n),w("recording"),v(!0),h.start()},children:"Record Video"})]})},de=function(e){var t=new MediaRecorder(e,{mimeType:"video/webm; codecs=h264"}),n=[];t.addEventListener("dataavailable",(function(e){n.push(e.data)}));return{start:function(){n.length=0,t.start()},stop:function(){return new Promise((function(e){t.addEventListener("stop",(function(){var t=new Blob(n,{type:"video/webm"}),r=URL.createObjectURL(t);e({videoBlob:t,videoUrl:r})})),t.stop()}))}}},le=function(){var e=m((function(e){return!!e.videoStream})),t=m((function(e){return e.videoStream})),n=m((function(e){return e.isPlaybackReady})),a=m((function(e){return e.config.recordingDuration})),c=m((function(e){return e.isPhotoMode}));return Object(r.jsx)(r.Fragment,{children:!n&&Object(r.jsxs)("div",{className:"UserUi",children:[!e&&Object(r.jsx)(ie,{}),void 0!==t&&Object(r.jsxs)(r.Fragment,{children:[c?Object(r.jsx)(ne,{stream:t,duration:a}):Object(r.jsx)(ue,{stream:t,duration:a}),Object(r.jsx)(ce,{stream:t})]})]})})};var fe=function(){var e=m((function(e){var t;return null===(t=e.staticFiles)||void 0===t?void 0:t.start})),t=m((function(e){var t;return null===(t=e.staticFiles)||void 0===t?void 0:t.end})),n=m((function(e){var t;return null===(t=e.staticFiles)||void 0===t?void 0:t.soundOne})),a=m((function(e){return e.fakedRecordingPromise})),c=m((function(e){return e.videoStream})),i=m((function(e){return e.detectorCanvas}));return console.log(c),Object(r.jsx)("div",{className:"App",children:Object(r.jsxs)("div",{className:"AppContents",children:[c&&Object(r.jsx)(te,{stream:c}),Object(r.jsx)(le,{}),Object(r.jsx)(q,{}),!!e&&!!a&&!!t&&i&&n&&Object(r.jsx)(O,{start:f(e),tracking:k(i,n),middle:a,end:f(t)})]})})};o.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(fe,{})}),document.getElementById("root"))}},[[340,1,2]]]);