(this["webpackJsonpthree-videos"]=this["webpackJsonpthree-videos"]||[]).push([[0],[,,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(0),c=n(1),a=n.n(c),i=n(7),o=n.n(i),s=(n(15),n(16),n(2)),u=n.n(s),d=n(4),l=n(3),f=n(5),b=(n(18),function(e){return Object(r.jsx)("button",Object(f.a)(Object(f.a)({className:"Button"},e),{},{children:e.children}))}),j=(n(19),function(e){var t=e.reason;return Object(r.jsx)("div",{className:"Message ErrorMessage",children:Object(r.jsxs)("span",{children:["Error: ",t]})})}),v=function(e){var t=e.text;return Object(r.jsx)("div",{className:"Message PromptMessage",children:Object(r.jsx)("span",{children:t})})},p=function(e){var t=e.text;return Object(r.jsx)("div",{className:"Message SuccessMessage",children:Object(r.jsxs)("span",{children:["Success: ",t]})})},O=function(e){var t=e.text;return Object(r.jsx)("div",{className:"Message NeutralMessage",children:Object(r.jsx)("span",{children:t})})},x=n(8),h=n.n(x),m=n(9),g={streams:void 0,recordings:{},fakedRecording:void 0,staticVideos:void 0,isPlaybackReady:!1,config:{recordingDuration:3,apiUrl:"http://localhost:9000"}},w=h()((function(e,t){return Object(f.a)(Object(f.a)({},g),{},{setStreams:function(n){t().closeStreams();var r=n.audio,c=n.video;r.getTracks().forEach((function(e){e.addEventListener("ended",(function(){t().closeStreams()}))})),c.getTracks().forEach((function(e){e.addEventListener("ended",(function(){t().closeStreams()}))})),e({streams:n})},closeStreams:function(){var n=t().streams;if(n){var r=n.audio,c=n.video;r.getTracks().forEach((function(e){e.stop()})),c.getTracks().forEach((function(e){e.stop()}))}e({streams:void 0})},setVideoRecording:function(t){e({recordings:{video:t}})},setStaticVideos:function(t,n,r){e({staticVideos:{start:t,middle:n,end:r}})},setFakedRecording:function(t){e({fakedRecording:t})},setPlaybackReadiness:function(t){return e({isPlaybackReady:t})},resetState:function(){var n=t().config;e(Object(f.a)(Object(f.a)({},g),n))}})})),S=Object(m.a)(w),k=function(e){var t=e.apiUrl,n=S((function(e){var t;return null===(t=e.staticVideos)||void 0===t?void 0:t.middle})),a=S((function(e){var t;return null===(t=e.recordings)||void 0===t?void 0:t.video})),i=S((function(e){return e.fakedRecording})),o=S((function(e){return e.setFakedRecording})),s=Object(c.useState)(void 0===n?"awaitingAudioSource":void 0===a?"awaitingDestinationVideo":i?"success":"prompt"),f=Object(l.a)(s,2),x=f[0],h=f[1];Object(c.useEffect)((function(){h(void 0===n?"awaitingAudioSource":void 0===a?"awaitingDestinationVideo":i?"success":"prompt")}),[n,a,i]);var m=function(){var e=Object(d.a)(u.a.mark((function e(){var r,c,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&a){e.next=4;break}return console.error("Not all sources are ready. source: ".concat(n,", destination: ").concat(a,")")),h("errorSources"),e.abrupt("return");case 4:return(r=new FormData).append("image",a.blob),r.append("sound",n),e.prev=7,h("awaitingResult"),e.next=11,fetch(t+"/three_videos_demo",{method:"POST",body:r,mode:"cors"});case 11:return c=e.sent,e.next=14,c.blob();case 14:i=e.sent,h("success"),o(i),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(7),h("errorApi"),console.error(e.t0);case 23:case"end":return e.stop()}}),e,null,[[7,19]])})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)("div",{className:"Api",children:["awaitingAudioSource"===x&&Object(r.jsx)(O,{text:"Awaiting audio source"}),"awaitingDestinationVideo"===x&&Object(r.jsx)(O,{text:"Awaiting destination video"}),"prompt"===x&&Object(r.jsx)(v,{text:"Source and Destination ready to be faked"}),!x.includes("awaiting")&&Object(r.jsx)(b,{onClick:m,children:"Send to API"}),"awaitingResult"===x&&Object(r.jsx)(O,{text:"Waiting for Api response"}),"success"===x&&Object(r.jsx)(p,{text:"Got faked recording from Api"}),"errorApi"===x&&Object(r.jsx)(j,{reason:"Could not fetch from Api"}),"errorSources"===x&&Object(r.jsx)(j,{reason:"Souces are not ready"})]})},y=n.p+"static/media/1.6f4d89fa.mp4",R=n.p+"static/media/2.b65b1142.mp4",A=n.p+"static/media/3.7bc44234.mp4",E=function(){var e=S((function(e){return!!e.staticVideos})),t=S((function(e){return e.setStaticVideos})),n=Object(c.useState)(e?"loaded":"notLoaded"),a=Object(l.a)(n,2),i=a[0],o=a[1];return Object(c.useEffect)((function(){e||function(){var e=Object(d.a)(u.a.mark((function e(){var n,r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o("loading"),e.prev=1,e.next=4,fetch(y);case 4:return e.next=6,e.sent.blob();case 6:return n=e.sent,e.next=9,fetch(R);case 9:return e.next=11,e.sent.blob();case 11:return r=e.sent,e.next=14,fetch(A);case 14:return e.next=16,e.sent.blob();case 16:c=e.sent,o("loaded"),t(n,r,c),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(1),o("error"),console.error(e.t0);case 25:case"end":return e.stop()}}),e,null,[[1,21]])})));return function(){return e.apply(this,arguments)}}()()}),[e,t]),Object(r.jsxs)("div",{className:"StaticFileLoader",children:["notLoaded"===i&&Object(r.jsx)(O,{text:"Files not loaded"}),"loading"===i&&Object(r.jsx)(O,{text:"Files loading"}),"loaded"===i&&Object(r.jsx)(O,{text:"Files loaded!"}),"error"===i&&Object(r.jsx)(j,{reason:"Files could not load"})]})},U=(n(20),function(){var e=S((function(e){return e.staticVideos})),t=S((function(e){return e.fakedRecording})),n=S((function(e){return e.setPlaybackReadiness}));return Object(c.useEffect)((function(){n(!(!e||!t))}),[t,e,n]),e?t?Object(r.jsx)(p,{text:"Videos Ready"}):Object(r.jsx)(j,{reason:"Fake recording not received"}):Object(r.jsx)(j,{reason:"Static videos not loaded"})}),V=new AbortController,D=V.signal;function N(e){if(200===e.status)return e;throw new Error(e.statusText)}var P=function(e){var t=e.apiUrl,n=Object(c.useCallback)(Object(d.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t+"/three_videos_is_up",{method:"POST",mode:"cors",body:new FormData,signal:D}).then(N);case 3:return n=e.sent,e.next=6,n.blob();case 6:if(!(e.sent.size<=0)){e.next=9;break}throw new Error("API Failed. Did not get blob successfully");case 9:s("success"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),s("errorApi"),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,12]])}))),[t]);Object(c.useEffect)((function(){n();var e=setInterval(Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V.abort(),V=new AbortController,D=V.signal,e.next=5,n();case 5:case"end":return e.stop()}}),e)}))),1e4);return function(){return clearInterval(e)}}),[n]);var a=Object(c.useState)("idle"),i=Object(l.a)(a,2),o=i[0],s=i[1];return Object(r.jsxs)("div",{className:"Api",children:["idle"===o&&Object(r.jsx)(O,{text:"Api test idle"}),"success"===o&&Object(r.jsx)(p,{text:"Api is Up"}),"errorApi"===o&&Object(r.jsx)(j,{reason:"Api is down"})]})},C=(n(21),function(e){return Object(r.jsx)("div",{className:"LabelledInput",children:Object(r.jsxs)("label",{className:"Label",children:[Object(r.jsxs)("span",{children:[e.label," "]}),Object(r.jsx)("input",Object(f.a)(Object(f.a)({className:"Input"},e),{},{children:e.children}))]})})}),F=function(){return Object(r.jsxs)("div",{className:"Config",children:[Object(r.jsx)(C,{label:"Recording Duration:",name:"recordingDuration",type:"number",min:0,max:16,defaultValue:w.getState().config.recordingDuration,onChange:function(e){var t=w.getState().config,n=parseInt(e.target.value,10);w.setState({config:Object(f.a)(Object(f.a)({},t),{},{recordingDuration:n})})}}),Object(r.jsx)(C,{label:"API Url:",name:"apiUrl",type:"string",defaultValue:w.getState().config.apiUrl,onChange:function(e){var t=w.getState().config,n=e.target.value;w.setState({config:Object(f.a)(Object(f.a)({},t),{},{apiUrl:n})})}})]})},L=function(){var e=S((function(e){return e.config.apiUrl}));return Object(r.jsxs)("div",{className:"DevUi",children:[Object(r.jsx)(F,{}),Object(r.jsx)(E,{}),Object(r.jsx)(P,{apiUrl:e}),Object(r.jsx)(k,{apiUrl:e}),Object(r.jsx)(U,{}),Object(r.jsx)(b,{onClick:w.getState().resetState,children:"Reset State"})]})},T=function(e){var t=e.start,n=e.middle,a=e.end,i=Object(c.useRef)(null),o=Object(c.useState)([]),s=Object(l.a)(o,2),f=s[0],b=s[1],j=Object(c.useState)({width:0,height:0}),v=Object(l.a)(j,2),p=v[0],O=v[1],x=Object(c.useState)(0),h=Object(l.a)(x,2),m=h[0],g=h[1];return Object(c.useEffect)((function(){(function(){var e=Object(d.a)(u.a.mark((function e(){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t,n,a].map((function(e,t){return I(e,0===t?function(e){return O({width:e.videoWidth,height:e.videoHeight})}:function(){return{}})})));case 2:r=e.sent,b(r);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[a,n,t]),B(60,(function(){var e,t=f[m],n=null===(e=i.current)||void 0===e?void 0:e.getContext("2d");void 0!==t&&void 0!==n&&null!==n&&n.drawImage(t,0,0,p.width,p.height)})),Object(c.useEffect)((function(){if(0!==f.length){var e,t=f[m];if(void 0===t)throw new Error("currentVideoIndex out of range. Got ".concat(m,", expected between 0 and ").concat(f.length));return t.onended=function(){return g((m+1)%f.length)},(e=t).currentTime>0&&!e.paused&&!e.ended&&e.readyState>2||(console.log("playing video ".concat(m)),t.play()),function(){t.pause()}}}),[m,f]),Object(r.jsx)("canvas",{ref:i,width:p.width,height:p.height})};function I(e,t){return M.apply(this,arguments)}function M(){return(M=Object(d.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var c=document.createElement("video");c.src=URL.createObjectURL(t),c.load(),c.onloadeddata=function(){return e(c)},c.onerror=function(e){return r(e)},c.addEventListener("loadedmetadata",(function(){return n(c)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=function(e,t){var n=Object(c.useRef)(),r=Object(c.useRef)(),a=Object(c.useCallback)((function(e){if(void 0!==r.current){var n=e-r.current;t(n)}r.current=e}),[t]);Object(c.useEffect)((function(){var t=setInterval((function(){n.current=requestAnimationFrame(a)}),1e3/e);return function(){n.current&&cancelAnimationFrame(n.current),t&&clearInterval(t)}}),[a,e])},_=function(){var e=S((function(e){return!!e.streams})),t=S((function(e){return e.setStreams})),n=Object(c.useState)(e?"accepted":"prompt"),a=Object(l.a)(n,2),i=a[0],o=a[1];e&&"accepted"!==i&&o("accepted"),e||"accepted"!==i||o("errorDisconnected");var s=function(){var e=Object(d.a)(u.a.mark((function e(){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W();case 2:return n=e.sent,e.next=5,J();case 5:if(r=e.sent,n){e.next=9;break}return o("errorAudio"),e.abrupt("return");case 9:if(r){e.next=12;break}return o("errorVideo"),e.abrupt("return");case 12:t({audio:n,video:r});case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.jsxs)("div",{className:"Permissions",children:[Object(r.jsx)(v,{text:"This is an interactive documentary. The interaction is provided via your microphone and webcam. Please enable this now."}),Object(r.jsx)(b,{onClick:s,children:"Enable Webcam & Audio"}),"accepted"===i&&Object(r.jsx)(v,{text:"Devices connected!"}),"errorAudio"===i&&Object(r.jsx)(j,{reason:"Could not get microphone."}),"errorVideo"===i&&Object(r.jsx)(j,{reason:"Could not get webcam."}),"errorDisconnected"===i&&Object(r.jsx)(j,{reason:"Devices disconnected."})]})};function W(){return G.apply(this,arguments)}function G(){return(G=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 3:return t=e.sent,e.abrupt("return",t);case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",void 0);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function J(){return q.apply(this,arguments)}function q(){return(q=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:{width:1280,height:720,facingMode:"user"},audio:!1});case 3:return t=e.sent,e.abrupt("return",t);case 7:return e.prev=7,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",void 0);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}var z=function(e){var t=e.stream,n=e.duration,a=Object(c.useState)(n),i=Object(l.a)(a,2),o=i[0],s=i[1],f=Object(c.useState)(!1),j=Object(l.a)(f,2),p=j[0],x=j[1],h=S((function(e){return e.setVideoRecording})),m=Object(c.useMemo)((function(){return H(t)}),[t]),g=Object(c.useState)("prompt"),w=Object(l.a)(g,2),k=w[0],y=w[1];Object(c.useEffect)((function(){p||"recorded"!==k&&(y("prompt"),s(n),x(!1))}),[p,k,t,n]),Object(c.useEffect)((function(){if(p){var e=setTimeout(Object(d.a)(u.a.mark((function e(){var t,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o>0)){e.next=3;break}return s(o-1),e.abrupt("return");case 3:return e.next=5,m.stop();case 5:t=e.sent,n=t.videoBlob,r=t.videoUrl,y("recorded"),x(!1),h({blob:n,url:r});case 11:case"end":return e.stop()}}),e)}))),1e3);return function(){return clearTimeout(e)}}}),[p,h,o,m]);return Object(r.jsxs)("div",{className:"VideoRecorder",children:["prompt"===k&&Object(r.jsx)(v,{text:"Our AI needs to be trained. Please record ".concat(n," seconds of your webcam")}),"recording"===k&&Object(r.jsx)(O,{text:"Recoding for another: ".concat(o,"s")}),"recorded"===k&&Object(r.jsx)(O,{text:"Trained!"}),"recording"!==k&&Object(r.jsx)(b,{onClick:function(){s(n),y("recording"),x(!0),m.start()},children:"Record Video"})]})},H=function(e){var t=new MediaRecorder(e,{mimeType:"video/webm; codecs=h264"}),n=[];t.addEventListener("dataavailable",(function(e){n.push(e.data)}));return{start:function(){n.length=0,t.start()},stop:function(){return new Promise((function(e){t.addEventListener("stop",(function(){var t=new Blob(n,{type:"video/webm"}),r=URL.createObjectURL(t);e({videoBlob:t,videoUrl:r})})),t.stop()}))}}},K=(n(22),function(e){var t=e.stream,n=Object(c.useRef)(null);return Object(c.useEffect)((function(){n.current&&(n.current.srcObject=t)}),[t]),Object(r.jsx)("div",{className:"VideoStreamPreview",children:Object(r.jsx)("video",{autoPlay:!0,ref:n})})}),Q=(n(23),function(){var e=S((function(e){return!!e.streams})),t=S((function(e){var t;return null===(t=e.streams)||void 0===t?void 0:t.video})),n=S((function(e){return e.isPlaybackReady})),c=S((function(e){return e.config.recordingDuration}));return Object(r.jsx)(r.Fragment,{children:!n&&Object(r.jsxs)("div",{className:"UserUi",children:[!e&&Object(r.jsx)(_,{}),void 0!==t&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(z,{stream:t,duration:c}),Object(r.jsx)(K,{stream:t})]})]})})});var X=function(){var e=S((function(e){return e.staticVideos})),t=S((function(e){return e.fakedRecording}));return Object(r.jsx)("div",{className:"App",children:Object(r.jsxs)("div",{className:"AppContents",children:[Object(r.jsx)(Q,{}),Object(r.jsx)(L,{}),!!e&&!!t&&Object(r.jsx)(T,{start:e.start,middle:t,end:e.end})]})})},Y=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,25)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),c(e),a(e),i(e)}))};o.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(X,{})}),document.getElementById("root")),Y()}],[[24,1,2]]]);
//# sourceMappingURL=main.f7e6b434.chunk.js.map